<!DOCTYPE html>
<html>
  <head>
    <!-- Load core scripts -->
    <title>Hello dotty neighbor</title>
    <script src="rpc-service.js"></script>
    <script src="user-service.js"></script>    
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
    <script src="https://nf404.github.io/crypto-api/crypto-api.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://mpld3.github.io/js/mpld3.v0.3.js"></script>  
  </head>

  <body>
  
    <!-- Define the layout -->  
  
    <div id="app">
      <h1>Hello, dotty neighbor</h1>
      <button @click="demoLogin">demo Login</button>
      <button @click="adminLogin">admin Login</button>      
      <button @click="logout">Logout</button> 
      Logged in User: {{ username }} 
      <br/>  
      <br/>        
      <button @click="sendRequest">Get new dots</button>
      <br/>
      {{ serverresponse }}      
      <div id="randomgraph"></div>
    </div>



<!-- Define the functionality -->

  <script>
    var app = new Vue({
      el: '#app',
      
      data: {
        username: '[none]',
        serverresponse: '[Click button to send request]' 
      }, 
      
      methods: {
        demoLogin: function () {
          var vm = this
          
          loginCall('demo', 'demo')
          .then(function (response) {
            if (response.data == 'success') {
              getCurrentUserInfo()
              .then(function (response) {
                vm.username = response.data.user.displayname
              })
            }
          })
        },

        adminLogin: function () {
          var vm = this
          
          loginCall('admin', 'admin')
          .then(function (response) {
            if (response.data == 'success') {
              getCurrentUserInfo()
              .then(function (response) {
                vm.username = response.data.user.displayname
              })
            }
          })          
        },
        
        logout: function () {
          var vm = this
          
          logoutCall()
          .then(function (response) {
            vm.username = '[none]'
          })      
        }, 
        
        sendRequest: function () {
          var vm = this;

//          getAllUsersInfo()
//          registerUser('ozzymandibulus', 'ozzy', 'Ozzymandibulus', 'tastybats@gmail.com')
//          deleteUser('ozzymandibulus')
          // Make a normal RPC call to get_graph().
//          rpcCall('test_func')
          rpcCall('get_graph')
          .then(function (response) {
            vm.serverresponse = 'See graph below';
            // If we already have a figure, pop the figure object, and clear the DOM -- WARNING, needs fixing
            if (mpld3.figures.length > 0) {
              mpld3.figures.pop();
              document.getElementById('randomgraph').innerHTML = '';
            }
            mpld3.draw_figure('randomgraph', response.data);
          })
          .catch(function (error) {
            vm.serverresponse = 'There was an error: ' + error.message;
          })
          
/*          // Make an upload RPC call to graph points in an uploaded .csv file.
          rpcUploadCall('show_csv_file', [], {}, '.csv')
          .then(function (response) {
            vm.serverresponse = 'See graph below';
            // If we already have a figure, pop the figure object, and clear the DOM -- WARNING, needs fixing
            if (mpld3.figures.length > 0) {
              mpld3.figures.pop();
              document.getElementById('randomgraph').innerHTML = '';
            }
            mpld3.draw_figure('randomgraph', response.data);
          })
          .catch(function (error) {
            vm.serverresponse = 'There was an error: ' + error.message;
          }) */

/*          // Make a download RPC call download a .csv file with random point in it.
          rpcDownloadCall('download_graph_png') 
          .catch(function (error) {
            vm.serverresponse = 'There was an error: ' + error.message;
          }) */
          
        }      
      }
    })
  </script>
  </body>
</html>